import"./main.BuTZy_Io.js";import"./index.CzQNLnSE.js";import{_ as me,x as _,u as ge,s as E,a as ee,o as he,r as xe,d as te,g as W,y as Ce,k as N,z as L,A as O,l as B,n as Pe,B as Se,v as we,t as Te,h as Ne,C as Le,D as ae,E as Y,p as Oe,F as re}from"./eo-dash.DGMIAB65.js";import{i as Me}from"./easing-CH0-9wR8.CTB3jml5.js";import ke from"./EodashMapBtns-D-HulIl1.DlGoWx65.js";import{h as M,ag as se,p as k,am as ie,v as oe,c as X,o as K,j as A,e as Q,k as i,N as D,G as _e,x as ue,q as Be}from"./framework.jnThnnVL.js";import"./lit-element.Deg-YTNa.js";import"./WMTS.BiyOiQUK.js";import"./Group.ovD7bfEG.js";import"./extent.B6zYA2nd.js";import"./GeoJSON.lExM6FuH.js";import"./index.BeKtm-vH.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.DkvUSKmd.js";import"./WKT.DZCyf9Ma.js";import"./item.Bx-rtsOD.js";import"./commonjsHelpers.BosuxZz1.js";import"./ExportState-DFVFAgKz.GfNh6QGa.js";import"./PopUp-DwI8V2gW.C4FDU7Wq.js";import"./forwardRefs-CRMFoNYN.B1VU85gr.js";import"./transition-6MJLK-_H.C-E94df7.js";import"./VImg-COXTnCWE.DWcT2caZ.js";import"./EodashItemFilter-CmZkk7GK.cnShVUeX.js";import"./handling-DTAhQuPh.DvjNjQnB.js";import"./async-D4G-FOIc.B57TAzIo.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.BoorRBTK.js";import"./index.BUIxO2d3.js";const ne=async(e,o,u)=>{B.debug("Creating layers config",e,o,u);const a=[],r={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const p of o){let t;if(u){const s=typeof u=="string"?new Date(u):u;t=await p.createLayersJson(s)}else t=await p.createLayersJson(void 0);t.forEach(s=>{s.properties.layerControlExpand=!0,s.properties.layerControlToolsExpand=!0}),r.layers.push(...t)}if(e!=null&&e.links){const p=e.links.filter(t=>Array.isArray(t.roles)&&(t.roles.includes("disable")||t.roles.includes("hidden")));p.length>0&&p.forEach(t=>{const s=t.id,n=r.layers.find(P=>P.properties.id.split(";:;")[0]===s);n&&(Array.isArray(t.roles)&&t.roles.includes("disable")?n.properties.visible=!1:Array.isArray(t.roles)&&t.roles.includes("hidden")&&(n.properties.layerControlHide=!0))})}a.push(r);const y=await re.getIndicatorLayers(e),f=re.getObservationPointsLayer(o);f&&r.layers.unshift(f);const d={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=y.filter(p=>p.properties.group==="baselayer");if(b.length){let p=0,t=0;for(let s=0;s<b.length;s++){const n=b[s];"visible"in n.properties||(n.properties.visible=!1),n.properties.visible&&(p++,t=s)}p===0&&(b[0].properties.visible=!0),p>0&&b.forEach((s,n)=>{n!==t?s.properties.visible=!1:s.properties.visible=!0}),d.layers.push(...b),d.layers.forEach(s=>{s.properties.layerControlExclusive=!0})}else d.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});d.layers.length&&a.push(d);const C={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},m=y.filter(p=>p.properties.group==="overlay");return m.length&&(C.layers.push(...m),a.unshift(C)),a};let H=null;const je=(e,o)=>{const u=a=>{var d;const r=a.map,y=(d=e.value)==null?void 0:d.lonLatCenter,f=r==null?void 0:r.getView().getZoom();y&&!Number.isNaN(y[0])&&!Number.isNaN(y[1])&&!Number.isNaN(f)&&(o.value=[y[0],y[1],f])};oe(()=>{var a,r;(r=(a=e.value)==null?void 0:a.map)==null||r.on("moveend",u)}),ue(()=>{var a,r;(r=(a=e.value)==null?void 0:a.map)==null||r.un("moveend",u)})},le=(e,o,u,a,r,y,f,d)=>{B.debug("InitMap",e.value,o.value,u.values,a.value);const C=Be(d?[o,a,d]:[o,a],async(m,p)=>{var S,G,J,R,Z,I,U,V,F,l,c,h,v,j,x,z;const[t,s,n]=d?m:[m[0],m[1],null],[P,q,g]=d?p:[p[0],p[1],null];if(t){B.debug("Selected Indicator watch triggered",t,s),((S=e==null?void 0:e.value)==null?void 0:S.id)==="main"&&H!==null&&((G=e==null?void 0:e.value)==null||G.map.setView(H),H=null);let w=[];const de=(t==null?void 0:t.id)===(P==null?void 0:P.id)&&(s!==q||n&&(n==null?void 0:n.id)!==(g==null?void 0:g.id)),{selectedCompareStac:fe}=E(ee());if(((J=e==null?void 0:e.value)==null?void 0:J.id)==="main"?await Le(t):fe.value!==null&&(H=((R=e==null?void 0:e.value)==null?void 0:R.map.getView())??null,e.value.sync=y.value),de){w=await ne(t,u,n??s),B.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(w))),r.value=w,ae(((Z=e.value)==null?void 0:Z.id)==="compare"?"compareTime:updated":"time:updated",e.value,w);return}let T=null;const $=(U=(I=t==null?void 0:t.extent)==null?void 0:I.temporal)==null?void 0:U.interval;if($&&$.length>0&&$[0].length>1&&(T=new Date($[0][1]),B.debug("Indicator load: found stac extent, setting time to latest value",T)),(!n&&T!==null&&T.toISOString()!==a.value&&!Y.value||Y.value&&!a.value&&T)&&(a.value=T.toISOString()),w=await ne(t,u,n??s),f&&!n&&((V=e==null?void 0:e.value)==null?void 0:V.id)==="main"&&(F=t.extent)!=null&&F.spatial.bbox&&!(Y.value&&((l=_.value)!=null&&l[0])&&((c=_.value)!=null&&c[1]))){const ye=(h=t.extent)==null?void 0:h.spatial.bbox[0],ve=Oe([...ye]),be=(x=e.value)==null?void 0:x.transformExtent(ve,"EPSG:4326",(j=(v=e.value)==null?void 0:v.map)==null?void 0:j.getView().getProjection());e.value.zoomExtent=be}B.debug("Assigned layers",JSON.parse(JSON.stringify(w))),r.value=w,await ae(((z=e.value)==null?void 0:z.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,r.value)}},{immediate:!0});ue(()=>{C()})},pe=(e,o)=>{Pe(async(u,a)=>{if(u.includes("compare"))return;const r=[];for(const y of e)r.push(...await y.getToolTipProperties());o.value=r,B.debug("Updated tooltip properties",o.value)})},ze="#cursor-coordinates[data-v-5143a869]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media (max-width: 959px){#cursor-coordinates[data-v-5143a869]{display:none}}#scale-line[data-v-5143a869]{position:fixed;left:24px;bottom:28px;color:#fff}@media (max-width: 959px){#scale-line[data-v-5143a869]{bottom:102px}}[data-v-5143a869] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-5143a869] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-5143a869]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-5143a869]>*{pointer-events:auto}",Ae=[".enabled"],Ie=[".center",".zoom",".layers",".controls"],Ve=[".propertyTransform"],Fe=[".layers"],Ge=[".propertyTransform"],Je={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Re={key:1,id:"scale-line",ref:"scale-line"};var ce;const Ze={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=_.value)==null?void 0:e[0])??15,((o=_.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((ce=_.value)==null?void 0:ce[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0,searchParams:{}})}},setup(e){var F;const o=e,{width:u}=ge(),a=l=>{if(typeof l=="number")return l;if(typeof l=="string"){const c=l.split("/"),h=u.value;return h<960?parseInt(c[0])||1:h<1920?parseInt(c[1]||c[0])||1:parseInt(c[2]||c[1]||c[0])||1}return 1},r=M(()=>a(o.btnsPosition.x)),y=M(()=>a(o.btnsPosition.y)),f=M(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0,searchParams:o.btns.searchParams})),d=se("scale-line"),b=se("cursor-coords"),C=k([]),m=k([]),p=M(()=>{const l={Attribution:{collapsible:!0}};return o.enableScaleLine&&d.value&&(l.ScaleLine={target:d.value}),o.enableCursorCoordinates&&b.value&&(l.MousePosition={projection:"EPSG:4326",coordinateFormat:c=>`${c[1].toFixed(3)} °N, ${c[0].toFixed(3)} °E`,target:b.value}),l}),t=ie(o.center),s=ie(((F=_.value)==null?void 0:F[2])??o.zoom),n=k([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),P=k([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),q={duration:1200,easing:Me},g=k(null),S=k(null),{selectedCompareStac:G}=E(ee()),J=M(()=>o.enableCompare&&G.value?"":"first");je(g,_),oe(()=>{const{selectedCompareStac:l,selectedStac:c,selectedItem:h}=E(ee());he.value=g.value,o.enableCompare&&(xe.value=S.value),o.enableCompare&&(le(S,l,Ne,te,P,g,!1),pe(W,m)),le(g,c,W,te,n,S,o.zoomToExtent,h)}),pe(W,C);const R=M(()=>({visibility:C.value.length?"visible":"hidden"})),Z=M(()=>({visibility:m.value.length?"visible":"hidden"})),I=l=>{const c=l==="main"?C:m,h=l=="main"?we:Te;return v=>{const j=JSON.parse(Se.render(JSON.stringify(c.value),{...h.value??{}})),x=j==null?void 0:j.find(z=>z.id===v.key);if(x){if(typeof v.value=="object"&&(v.value=JSON.stringify(v.value)),!isNaN(Number(v.value))){const z=isNaN(Number(x.decimals))?4:Number(x.decimals);v.value=Number(v.value).toFixed(z).toString()}return{key:x.title||x.id,value:v.value+" "+(x.appendix||"")}}}},{mainRect:U}=Ce(),V=k(0);return oe(()=>{const l=document.querySelector("eo-dash");V.value=(U.value.top||(l==null?void 0:l.getBoundingClientRect().top))??0}),(l,c)=>(K(),X("span",null,[A("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":J.value},[A("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:g,id:"main",".animationOptions":q,".center":i(t),".zoom":i(s),".layers":n.value,".controls":p.value},[A("eox-map-tooltip",{style:D(R.value),".propertyTransform":I("main")},null,44,Ve)],40,Ie),A("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:S,".layers":P.value},[A("eox-map-tooltip",{style:D(Z.value),".propertyTransform":I("compare")},null,44,Ge)],40,Fe)],40,Ae),e.enableCursorCoordinates?(K(),X("div",Je,null,512)):Q("v-if",!0),e.enableScaleLine?(K(),X("span",Re,null,512)):Q("v-if",!0),A("div",{class:"map-buttons-container",style:D(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${V.value}px;`)},[Q(" prettier-ignore "),_e(ke,{style:D({gridColumn:i(N)||i(L)||i(O)?r.value:"12",gridRow:y.value}),exportMap:i(N)||i(L)||i(O)?f.value.exportMap:!1,changeProjection:i(N)||i(L)||i(O)?f.value.changeProjection:!1,compareIndicators:i(N)||i(L)||i(O)?f.value.compareIndicators:!1,backToPOIs:i(N)||i(L)||i(O)?f.value.backToPOIs:!1,enableSearch:i(N)||i(L)||i(O)?f.value.enableSearch:!1,enableZoom:i(N)||i(L)||i(O)?f.value.enableZoom:!1,searchParams:f.value.searchParams},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom","searchParams"])],4)]))}},xo=me(Ze,[["styles",[ze]],["__scopeId","data-v-5143a869"]]);export{xo as default};
