import"./main.Cp_PLOG0.js";import"./main.DddtdkOv.js";import"./main.B45lSlKc.js";import{_ as G,s as U,a as Q,r as W,o as X,z as Y,k as Z,bb as $,V as R,bc as ee,bd as ae,n as te,be as oe,bf as se,bg as re}from"./eo-dash.Wnh66Ill.js";import{c as ne,j as ie,P as le}from"./ProcessList-C9eAg2Sb.BXTgVly_.js";import{o as A,i as L,u as ce,h as ue}from"./handling-DTAhQuPh.B-KO5Izk.js";import{g as pe,f as de,n as fe}from"./async-D4G-FOIc.BFZ4rDVE.js";import{p as f,ag as _,h as C,q as P,c as B,o as h,G as ve,e as w,j as me,k as b,N as ye,am as J,b as D,w as K,a as z,v as E,P as he}from"./framework.gkUS30S7.js";import"./lit-element.Deg-YTNa.js";import"./addCommonStyleSheet.zOcQQLUh.js";import"./sequential.BHUe01AH.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.oNa9w_hR.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.lExM6FuH.js";import"./extent.B6zYA2nd.js";import"./WKT.DZCyf9Ma.js";import"./browser.Ph8RqVkT.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./index.DCVKSTf4.js";import"./item.Bx-rtsOD.js";import"./index-DEmHaCL3.D2Lm1iYg.js";import"./VTooltip-BLS-cQ9N.bIGoiTZ1.js";import"./forwardRefs-CRMFoNYN.BLuK8e7O.js";import"./transition-6MJLK-_H.5LJSJL3M.js";const be=({selectedStac:r,jsonformEl:n,jsonformSchema:u,chartSpec:c,isProcessed:i,processResults:s,loading:p,isPolling:o,mapElement:a})=>{const m=ae(oe);E(async()=>{((a==null?void 0:a.layers.length)??0)>1?await L({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:u,chartSpec:c,isProcessed:i,processResults:s,loading:p,isPolling:o}):m.once(async()=>{await L({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:u,chartSpec:c,isProcessed:i,loading:p,processResults:s,isPolling:o})})});const g=(a==null?void 0:a.id)==="compare"?"compareLayers:updated":"layers:updated";te(async(d,v)=>{(d=="layertime:updated"||d=="compareLayertime:updated"||d=="time:updated"||d=="compareTime:updated")&&await ce({jsonformSchema:u,newLayers:v}),d===g&&await L({enableCompare:(a==null?void 0:a.id)==="compare",selectedStac:r,jsonformEl:n,jsonformSchema:u,chartSpec:c,isProcessed:i,processResults:s,loading:p,isPolling:o})})};function ge(r,n,u,c){const i=async o=>{await c()},s=async()=>{await he(()=>{var o;(o=n.value)==null||o.addEventListener("change",i)})},p=()=>{var o;(o=n.value)==null||o.removeEventListener("change",i)};P(u,o=>{var a;r.value=((a=o==null?void 0:o.options)==null?void 0:a.execute)||!1}),E(()=>{P(r,async o=>{o?await s():p()},{immediate:!0})})}const xe="eox-chart{--background-color: transparent;padding-top:1em}eox-jsonform{padding:.7em;min-height:0px}",Ce={ref:"container",class:"pb-4"},we=[".schema"],ke=[".spec",".dataValues",".opt"],Le={class:"mt-4 text-right"},_e={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(r){const n=f(null),u=f(null),c=f(!1),i=f(null),s=_("jsonformEl"),p=_("chartElRef"),o=C(()=>{var e;return(e=T.value)==null?void 0:e.links.filter(t=>t.endpoint==="eoxhub_workspaces").length}),a=_("container"),m=f(!1),g=f(!1),d=f(!1),v=f([]),F=C(()=>!g.value&&(!!i.value||!!n.value)&&!!s.value),{selectedStac:T,selectedCompareStac:H}=U(Q()),k=r.enableCompare?H:T,x=r.enableCompare?W:X,j=r.enableCompare?Y:Z,V=r.enableCompare?ne:ie,M=C(()=>{var e;return j.value+((e=x.value)==null?void 0:e.id)});be({selectedStac:k,mapElement:x.value,jsonformEl:s,jsonformSchema:i,chartSpec:n,isProcessed:c,processResults:v,loading:m,isPolling:d});const S=()=>{v.value.forEach(e=>{var l;if(!e)return;let t="";typeof e=="string"?(t=e.includes("/")?e.split("/").pop()??"":e,t=t.includes("?")?t.split("?")[0]:t):t=((l=k.value)==null?void 0:l.id)+"_process_results.json",fe(t,e)})},I=async()=>{var y,N,O;const e=pe(i.value);if(e&&Array.isArray((y=s.value)==null?void 0:y.value[e])&&!((N=s.value)!=null&&N.value[e].length)){c.value=!1,n.value=null;return}const l=(O=s.value)==null?void 0:O.editor.validate();if(l!=null&&l.length){console.warn("[eodash] Form validation failed",l);return}v.value=[],await ue({jobs:V,selectedStac:k,jsonformEl:s,jsonformSchema:i,chartSpec:n,chartData:u,loading:m,isPolling:d,processResults:v,mapElement:x.value}),c.value=!0,o.value&&de(V,j.value)};ge(g,s,i,I);const q=C(()=>{var t,l,y;const e={};return(t=n.value)!=null&&t.height||(e.height=Math.max((((l=a.value)==null?void 0:l.offsetHeight)??0)-(((y=s.value)==null?void 0:y.offsetHeight)??0),200)+"px"),e});return P(p,e=>{r.enableCompare?se.value=e:re.value=e}),(e,t)=>(h(),B("div",Ce,[ve(le,{"map-element":b(x),"enable-compare":r.enableCompare},null,8,["map-element","enable-compare"]),i.value?(h(),B("eox-jsonform",{key:M.value,ref_key:"jsonformEl",ref:s,".schema":i.value},null,40,we)):w("v-if",!0),c.value&&n.value?(h(),B("eox-chart",{key:1,ref_key:"chartElRef",ref:p,class:"chart",".spec":J(n.value),".dataValues":J(u.value),"onClick:item":t[0]||(t[0]=(...l)=>b(A)&&b(A)(...l)),style:ye(q.value),".opt":r.vegaEmbedOptions},null,44,ke)):w("v-if",!0),me("div",Le,[F.value?(h(),D(R,{key:0,loading:m.value,style:{"margin-right":"20px"},"append-icon":[b($)],onClick:I,color:"primary"},{default:K(()=>[...t[1]||(t[1]=[z(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):w("v-if",!0),v.value.length&&c.value&&!o.value?(h(),D(R,{key:1,color:"primary","append-icon":[b(ee)],onClick:S},{default:K(()=>[...t[2]||(t[2]=[z(" Download ",-1)])]),_:1},8,["append-icon"])):w("v-if",!0)])],512))}},ta=G(_e,[["styles",[xe]]]);export{ta as default};
